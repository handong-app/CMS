<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Google OAuth Login</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <h2>Google OAuth 로그인</h2>
    <button id="loginBtn">구글 로그인 시작</button>

    <script>
      // Base URL 선택 드롭다운 추가
      const BASE_URLS = [
        { label: "로컬 (localhost:8080)", value: "http://localhost:8080" },
        {
          label: "운영 (https://cms.handong.app)",
          value: "https://cms.handong.app",
        },
      ];

      // 드롭다운 UI 삽입
      $(document).ready(function () {
        const selectHtml = `
        <label for="baseUrlSelect"><b>Base URL:</b></label>
        <select id="baseUrlSelect" style="margin-bottom:10px;">
          ${BASE_URLS.map(
            (opt) => `<option value="${opt.value}">${opt.label}</option>`
          ).join("")}
        </select>
      `;
        $(selectHtml).insertBefore("#loginBtn");
      });

      function getBaseUrl() {
        return $("#baseUrlSelect").val() || "http://localhost:8080";
      }

      $("#loginBtn").click(function () {
        const baseUrl = getBaseUrl();
        $.ajax({
          url: baseUrl + "/api/auth/google/client-id",
          method: "GET",
          success: function (clientId) {
            const redirectUri = encodeURIComponent(
              window.location.origin + "/complete.html"
            );
            const scope = encodeURIComponent(
              "openid email profile https://www.googleapis.com/auth/user.organization.read"
            );
            const authUrl =
              `https://accounts.google.com/o/oauth2/v2/auth?` +
              `client_id=${clientId}` +
              `&redirect_uri=${redirectUri}` +
              `&response_type=code` +
              `&scope=${scope}` +
              `&access_type=offline`;
            window.location.href = authUrl;
          },
          error: function () {
            alert("클라이언트 ID를 불러오지 못했습니다.");
          },
        });
      });
    </script>
  </body>
</html>
